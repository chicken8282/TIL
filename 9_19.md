# 9/19

# Template System

## Django Template system
파이썬 데이터 (context)를 HTML 문서(Template)와 결합하여, 로직과 표현을 분리한 채 동적인 웹페이지를 생성하는 도구

HTML의 콘텐츠를 변수 값에 따라 변경하기
1. 빨간 상자의 내용이 변수에 따라 바뀌게 해보자

![alt text](<images/09_19/스크린샷 2025-09-19 090642.png>)

2. context['name']이 변경되면 응답 받은 HTML의 모습도 변경되는 걸 확인 하자

![alt text](<images/09_19/스크린샷 2025-09-19 090757.png>)

Django Template system의 목적
- 페이지 틀에 데이터를 동적으로 결합하여 수 많은 페이지를 효율적으로 만들어 내기 위함

## Django Template Language (DTL)
Template에서 조건, 반복, 변수 등의 프로그래밍적 기능을 제공하는 시스템

1. Variable
- Django Tempalte에서의 변수
- render 함수의 세번째 인자로 딕셔너리 타입으로 전달됨
- 해당 딕셔너리 key에 해당하는 문자열이 template에서 사용 가능한 변수명이 됨
- dot('.')을 사용하여 변수 속성에 접근할 수 있음

![alt text](<images/09_19/스크린샷 2025-09-19 092217.png>)

2. Filters
- 표시할 변수를 수정할 때 사용 (변수 + '|' + 필터)
- chained(연결)이 가능하며 일부 필터는 인자를 받기도 함
- 약 60개의 built-in template filters를 제공
`{{ variable|filter}} {{ name|truncatewords:30 }}`
3. Tages
- 반복 또는 논리를 수행하여 제어 흐름을 만듦
- 일부 태그는 시작과 종료 태그가 필요
- 약 24개의 built-in template tags를 제공
`{% tag %} {% if %} {% endif %}`
- if, else, endif 태그

![alt text](<images/09_19/스크린샷 2025-09-19 113457.png>)
- for 태그

![alt text](<images/09_19/스크린샷 2025-09-19 113524.png>)

4. Comments
- 주석
  - inline
  `<h1> Hello, {# name #}</h1>`
  - multiline
  ```
  {% comment %}
  ...
  {% endcommnet %}
  ```
DTL 예시

![alt text](<images/09_19/스크린샷 2025-09-19 113800.png>)
![alt text](<images/09_19/스크린샷 2025-09-19 113812.png>)

# 템플릿 상속
기본 템플릿 구조의 한계
- 만약 모든 템플릿에 Bootstrap을 적용하려면?
-> 모든 템플릿에 Bootstrap CDN을 작성해야 할까?

템플릿 상속 (Template inheritance)
1. 페이지의 공통요소를 포함
2. 하위 템플릿이 재정의 할 수 있는 공간을 정의
-> 여러 템플릿이 공통요소를 공유할 수 있게 해주는 기능

상속 구조 만들기
1. skeleton 역할을 하게 되는 상위 템플릿(base.html) 작성
  - 모든 템플릿이 공유했으면 좋겠는 공통요소를 작성
  - 템플릿 별로 재정의할 부분은 block태그를 활용

![alt text](<images/09_19/스크린샷 2025-09-19 095536.png>)

2. 기존 하위 템플릿들이 상위 템플릿을 상속받도록 변경
  - extends 태그로 상속받을 템플릿 결정
  - block 태그를 활용해 base.html의 같은 이름으로 작성된 block 태그의 내용을 대체

![alt text](<images/09_19/스크린샷 2025-09-19 095811.png>)
![alt text](<images/09_19/스크린샷 2025-09-19 095820.png>)

3. 최종 형태

![alt text](<images/09_19/스크린샷 2025-09-19 100125.png>)
## 상속 관련 DTL 태그
'extends' tag
`{% extends 'articles/base.html' %}`
- 자식(하위)템플릿이 부모 템플릿을 확장한다는 것을 알림
- 반드시 자식 템플릿 최상단에 작성되어야 함 (extends 태그는 2개 이상 사용 불가)
'block tag'
`{% block 'content' %} {% endblock 'content' %}` 
- 하위 템플릿에서 재정의 할 수 있는 블록을 정의
- 상위 템플릿에서 작성하며 하위 템플릿이 작성할 수 있는 공간을 지정하는 것

![alt text](<images/09_19/스크린샷 2025-09-19 100456.png>)

# 요청과 응답

## HTML form
데이터를 보내고 가져오기

HTML 'form' element를 통해 사용자와 애플리케이션 간의 상호작용 이해하기

HTML form
  - HTTP 요청을 서버에 보내는 가장 편리한 방법

![alt text](<images/09_19/스크린샷 2025-09-19 100633.png>)
![alt text](<images/09_19/스크린샷 2025-09-19 100648.png>)

실제 웹 서비스에서 form이 사용되는 예시
  - 네이버 & 구글의 로그인 화면에서 사용하는 HTML form 요소

![alt text](<images/09_19/스크린샷 2025-09-19 100754.png>)

'form' element\
사용자로부터 할당된 데이터를 서버로 전송하는 HTML 요소

-> 웹에서 사용자 정보를 입력하는 여러 방식 (text, password, checkbox등)을 제공

form을 이용해 Naver로 요청 보내기: "fake Naver"

fake Naver 실습

1. form 요소로 검색창 만들기

![alt text](<images/09_19/스크린샷 2025-09-19 113953.png>)

1. input에 hello를 입력하고 제출 버튼을 누른 뒤 브라우저 URL 확인

![alt text](<images/09_19/스크린샷 2025-09-19 114106.png>)

1. 실제 Naver에서 검색 후 URL 확인

![alt text](<images/09_19/스크린샷 2025-09-19 114133.png>)

1. action의 URL 변경 후 테스트

![alt text](<images/09_19/스크린샷 2025-09-19 114158.png>)

## HTML form 핵심 속성
action & method\
form의 핵심 속성 2가지\
데이터를 어디(action)로 어떤 방식(method)으로 요청할지

**action** & **method** 예시

![alt text](<images/09_19/스크린샷 2025-09-19 102242.png>)

action
- 입력 데이터가 전송될 URL을 지정 (목적지)
- actions을 지정하지 않으면 데이터는 현재 페이지의 URL로 설정된다.

method
- 데이터를 어떤 방식으로 보낼 것인지 정의
- 데이터의 HTTP request method(GET, POST)를 지정

**input** element
사용자의 데이터를 입력 받을 수 있는 HTML 요소 type 속성 값에 따라 다양한 유형의 입력 데이터를 받음\
-> 핵심 속성 - name

'name' attribute
`<input type="text" name="query" id="message">`
- input 요소의 핵심 속성
- 사용자가 입력한 데이터에 붙이는 이름(key)
- 데이터를 제출했을 때 서버는 name 속성에 설정된 값을 통해서만 사용자가 입력한 데이터에 접근할 수 있음

Query String Parameters
- 사용자의 입력 데이터를 URL주소에 파라미터를 통해 서버로 보내는 방법
- 문자열은 앰퍼샌드('&')로 연결된 key=value 쌍으로 구성되며, 기본 URL과는 물음표('?')로 구분됨

예시
- http://host:port/path?key=value&key=value

## HTML form 활용
사용자 입력 데이터를 받아 그대로 출력하는 서버 만들기

![alt text](<images/09_19/스크린샷 2025-09-19 114755.png>)

1. throw 로직 작성

![alt text](<images/09_19/스크린샷 2025-09-19 114827.png>)
2. catch 로직 작성

![alt text](<images/09_19/스크린샷 2025-09-19 114846.png>)

HTTP request 객체
- form으로 전송한 데이터 뿐만 아니라 Django로 들어오는 모든 요청 관련 데이터가 담겨 있음 (view함수가 호출될 때 첫번째 인자로 전달됨)

request 객체 살펴보기
- view 함수의 request 매개변수가 여러가지 정보를 확인해보자.
 
![alt text](<images/09_19/스크린샷 2025-09-19 115019.png>)

request 객체에서 form 데이터 추출
- request.GET에 작성한 messagea가 담겨있음을 확인할 수 있다.

![alt text](<images/09_19/스크린샷 2025-09-19 115141.png>)

3. catch 로직 마무리
- throw 페이지에서 요청한 사용자 입력 데이터는 어떻게 가져와야 할까?

![alt text](<images/09_19/스크린샷 2025-09-19 115231.png>)

throw - catch 간 요청과 응답 정리
- 브라우저에 http://127.0.0.1:8000/throw/를 입력하면 발생하는 일

![alt text](<images/09_19/스크린샷 2025-09-19 115321.png>)

- throw 페이지에서 일어나는 일

![alt text](<images/09_19/스크린샷 2025-09-19 115355.png>)

# Django URLs
URL dispathcer(운항 관리자, 분배기)

URL 패턴을 정의하고 해당 패턴이 일치하는 요청을 처리할 view 함수를 연결(매핑)

## Varialbe Routing
현재 URL 관리의 문제점
- 템플릿의 많은 부분이 중복되고, URL의 일부만 변경되는 상황이라면?
- 계속해서 비슷한 URL과 템플릿을 작성해 나가야 할까?

Variable Routing
- URL 일부에 변수를 포함시키는 것
  - 변수는 view 함수의 인자로 전달할 수 있음

![alt text](<images/09_19/스크린샷 2025-09-19 115645.png>)

![alt text](<images/09_19/스크린샷 2025-09-19 115912.png>)
- 요청 URL의 <int:num>,<str:name>의 위치에 들어있는 값이 변수처럼 취급됨
  - 정수 num 변수가 views.detail에, 문자열 name 변수가 views.greeting에 키워드 인자로 전달됨
  - 예: 요청 URL이 /articles/10/ 이면, views.detail(request, num=10)의 형태로 호출
- Path Converter
  - URL변수의 타입을 지정
  - str, int 등 5가지 타입 지원

Variable Routing 실습

1. ![alt text](<images/09_19/스크린샷 2025-09-19 120000.png>)
2. ![alt text](<images/09_19/스크린샷 2025-09-19 120019.png>)
3. ![alt text](<images/09_19/스크린샷 2025-09-19 120034.png>)
4. ![alt text](<images/09_19/스크린샷 2025-09-19 120045.png>)

## App URL 정의
App URL mapping
각 앱에 URL을 정의하는 것
프로젝트와 각 앱이 URL을 나누어 관리를 편하게 하기 위함
현재는 앱이 하나밖에 없지만, 앞으로 앱이 늘어나게 되면 서로 다른 앱의 URL들이 섞이지 않도록 나누어 관리하는 방법

2번째 앱 pages 생성 후 발생할 수 있는 문제
- view 함수 이름이 같거나, 같은 패턴의 URL 주소를 사용하게 되는 경우
- 아래와 같이 해결해 볼 수 있으나 더 좋은 방법이 필요
- 
![alt text](<images/09_19/스크린샷 2025-09-19 120258.png>)

기존 URL 구조
- 프로젝트 urls.py에 모든 URL이 담겨있음

![alt text](<images/09_19/스크린샷 2025-09-19 120328.png>)

변경된 URL 구조
- 각 앱의 urls.py에서 각자의 URL 관리
![alt text](<images/09_19/스크린샷 2025-09-19 120400.png>)

`include('app.urls')`
프로젝트 내부 앱들의 URL을 참조할 수 있도록 매핑하는 함수

URL의 일치하는 부분까지 잘라내고, 남은 문자열 부분은 후속 처리를 위해 include된 URL로 전달

include 함수
- 각 앱에서 urls.py를 만들고

![alt text](<images/09_19/스크린샷 2025-09-19 120901.png>)

- 프로젝트 urls.py에서 include()로 추가

![alt text](<images/09_19/스크린샷 2025-09-19 120916.png>)

요청 URL이 http://127.0.0.1.8000/articles/index/ 일 때

- firstpjt/urls.py에서 articles/까지 일치 한 뒤
- articles/urls.py에서 나머지 index/ 를 찾음

![alt text](<images/09_19/스크린샷 2025-09-19 121136.png>)

![alt text](<images/09_19/스크린샷 2025-09-19 121359.png>)
![alt text](<images/09_19/스크린샷 2025-09-19 121407.png>)

# URL 이름 지정

## Naming URL patterns
URL 구조 변경에 따른 문제점
- 기존 `articles/주소`가 `articles/index/`로 변경됨에 따라 해당 URL을 사용하는 모든 위치를 찾아가 변경해야 함

![alt text](<images/09_19/스크린샷 2025-09-19 121554.png>)

-> URL에 이름을 지어주면 이름만 기억하면 되지 않을까?

Naming URL patterns
- URL에 이름을 지정하는 것
- path 함수에 name 인자를 키워드 인자로 정의해서 사용

![alt text](<images/09_19/스크린샷 2025-09-19 121722.png>)

URL 표기 변화
- 해당 url을 사용했던 곳의 링크 변경
  - 새로운 articles/urls.py

![alt text](<images/09_19/스크린샷 2025-09-19 121818.png>)

- articles/index.html 변화

![alt text](<images/09_19/스크린샷 2025-09-19 121846.png>)

- 브라우저 상의 실제 링크 확인

![alt text](<images/09_19/스크린샷 2025-09-19 121916.png>)

## DTL URL tag
`{% url 'url_name' arg1 arg2 %}`

주어진 URL패턴의 이름과 일치하는 절대 경로 주소를 반환

URL에 이름을 붙였을 경우 url 태그와 이름을 이용해 템플릿 상에서 이름으로 실제 주소를 작성할 수 있게 해준다.

**url** tag
- 주어진 URL 패턴의 이름과 일치하는 절대 경로 주소를 반환

![alt text](<images/09_19/스크린샷 2025-09-19 122512.png>)

- URL 패턴에 변수가 포함되어 있으면, 'url_name'이후 추가

![alt text](<images/09_19/스크린샷 2025-09-19 122543.png>)

- DTL의 for 태그에서 사용한 변수 이름 사용 가능

![alt text](<images/09_19/스크린샷 2025-09-19 122617.png>)

# URL 이름 공간

## app_name 속성
URL 이름 지정 후 남은 문제
- aritcles 앱의 url 이름과 pages 앱의 url 이름이 같은 상황
- 단순히 이름만으로는 완벽하게 분리할 수 없음
  - articles와 pages모두 index가 있다.

![alt text](<images/09_19/스크린샷 2025-09-19 122749.png>)

app_name 속성 지정
- urls.py에 app_name 변수 설정

![alt text](<images/09_19/스크린샷 2025-09-19 122847.png>)

- app_name이 추가 또는 수정되면 url 태그에도 해당 내용이 반영되어야 함

![alt text](<images/09_19/스크린샷 2025-09-19 123035.png>)

- HTML 반영 후 확인
- 최종 링크는 변하지 않음

![alt text](<images/09_19/스크린샷 2025-09-19 123111.png>)

# 참고

## 추가 템플릿 경로
추가 템플릿 경로 지정
- 앱 폴더 내부 templates 폴더(기본 경로) 외에 템플릿을 위치하고 싶을 때
![alt text](<images/09_19/스크린샷 2025-09-19 123322.png>)

- 새로운 템플릿 경로
![alt text](<images/09_19/스크린샷 2025-09-19 123341.png>)

- 하위 템플릿에서 extends의 경로 수정 필요
`{% extends 'base.html' %}`

BASE_DIR
- settings.py에서 경로지정을 편하게 하기 위해 최상단 지점을 지정해 둔 변수
```python
# settings.py
BASE_DIR = Path(__file__).resolve().parent.parent
```

![alt text](<images/09_19/스크린샷 2025-09-19 162123.png>)
## DTL 주의사항
- Python 처럼 일부 프로그래밍 구조(if, for 등)를 사용할 수 있지만 명칭을 그렇게 설계 했을 뿐
- Python 코드로 실행되는 것이 아니며 Python과는 관련 없음
- 프로그래밍적 로직이 아니라 표현을 위한 것임을 명심하기
- 프로그래밍적 로직은 되도록 view 함수에서 작성 및 처리할 것
- 공식 문서를 참고해 다양한 태그와 필터 사용해보기
  - https://docs.djangoproject.com/en/5.2/ref/templates/builtins/
## Trailing Slashes
- Django는 URL끝에 '/'가 없다면 자동으로 붙임
- "기술적인 측면에서,`foo.com/bar`와 `foo.com/bar/`는 서로 다른 URL"
  - 검색 엔진 로봇이나 웹 트래픽 분석 도구에서는 이 두 주소를 서로 다른 페이지로 보기 때문
- 그래서 Django는 검색 엔진이 혼동하지 않게 하기 위해 무조건 붙이는 것을 선택한 것
- 그러나 모든 프레임워크가 이렇게 동작하는 것은 아니니 주의